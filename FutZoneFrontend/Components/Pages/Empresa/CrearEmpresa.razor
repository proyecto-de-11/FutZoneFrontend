@page "/empresas/crear"
@using FutZoneFrontend.DTOs
@using FutZoneFrontend.Services
@inject EmpresaService EmpresaService
@inject NavigationManager NavigationManager

<h3>Crear Nueva Empresa 📝</h3>
<hr />

<EditForm Model="@empresaModel" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="nombre">Nombre:</label>
                <InputText id="nombre" @bind-Value="empresaModel.Nombre" class="form-control" placeholder="Escribe el nombre de la empresa" />
                <ValidationMessage For="@(() => empresaModel.Nombre)" />
            </div>

            <div class="form-group mb-3">
                <label for="tipo">Tipo:</label>
                <InputText id="tipo" @bind-Value="empresaModel.Tipo" class="form-control" placeholder="Ej: Canchas Sintéticas, Gimnasio, etc." />
                <ValidationMessage For="@(() => empresaModel.Tipo)" />
            </div>

            <div class="form-group mb-3">
                <label for="ubicacion">Ubicación:</label>
                <InputText id="ubicacion" @bind-Value="empresaModel.Ubicacion" class="form-control" placeholder="Dirección completa o ciudad" />
                <ValidationMessage For="@(() => empresaModel.Ubicacion)" />
            </div>

            <div class="form-group mb-3">
                <label for="contactos">Contactos (Teléfono/WhatsApp):</label>
                <InputText id="contactos" @bind-Value="empresaModel.Contactos" class="form-control" placeholder="Ej: +503 7777-8888" />
                <ValidationMessage For="@(() => empresaModel.Contactos)" />
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="descripcion">Descripción:</label>
                <InputTextArea id="descripcion" @bind-Value="empresaModel.Descripcion" class="form-control" rows="3" placeholder="Describe brevemente la empresa y sus servicios" />
                <ValidationMessage For="@(() => empresaModel.Descripcion)" />
            </div>

            <div class="form-group mb-3">
                <label for="correo">Correo Electrónico:</label>
                <InputText id="correo" @bind-Value="empresaModel.Correo" class="form-control" placeholder="ejemplo@empresa.com" />
                <ValidationMessage For="@(() => empresaModel.Correo)" />
            </div>

            <div class="form-group mb-3">
                <label for="imagen">URL del Logo:</label>
                <InputText id="imagen" @bind-Value="empresaModel.Imagen" class="form-control" placeholder="Copia aquí la URL de tu logo o banner" />
                <ValidationMessage For="@(() => empresaModel.Imagen)" />
            </div>
        </div>
    </div>

    <div class="mt-4">
        @if (!string.IsNullOrEmpty(mensaje))
        {
            <div class="@(esExito ? "alert alert-success" : "alert alert-danger")" role="alert">
                @mensaje
            </div>
        }

        <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
            @if (isSubmitting)
            {
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span>Guardando...</span>
            }
            else
            {
                <span>Guardar Empresa</span>
            }
        </button>
        <button type="button" class="btn btn-secondary" @onclick="GoBack">Cancelar</button>
    </div>
</EditForm>

<style>
    /* Estilos para el color del texto del placeholder en los campos oscuros */
    .form-control::placeholder { /* Estándar */
        color: white !important;
        opacity: 0.8; /* Ajusta la opacidad si es necesario */
    }

    .form-control:-ms-input-placeholder { /* Para IE 10+ */
        color: white !important;
    }

    .form-control::-ms-input-placeholder { /* Para Edge */
        color: white !important;
    }
</style>


@code {
    private EmpresaCreationDto empresaModel = new EmpresaCreationDto();
    private string mensaje = string.Empty;
    private bool esExito = false;
    private bool isSubmitting = false;

    private void GoBack()
    {
        NavigationManager.NavigateTo("/organizaciones");
    }

    private async Task HandleValidSubmit()
    {
        isSubmitting = true;
        mensaje = string.Empty;

        var (empresaId, msg, success) = await EmpresaService.CreateEmpresaAsync(empresaModel);

        esExito = success;
        mensaje = msg;

        if (success)
        {
            Console.WriteLine($"Empresa {empresaId} creada, redirigiendo...");
            await Task.Delay(2000);
            NavigationManager.NavigateTo("/organizaciones");
        }

        isSubmitting = false;
    }
}