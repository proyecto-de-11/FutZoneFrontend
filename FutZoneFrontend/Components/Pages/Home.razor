@page "/home"
@using System.Collections.Generic
@using FutZoneFrontend.Services
@using FutZoneFrontend.Services.Models
@inject IPropietarioService PropietarioService

<style>
    body { background: linear-gradient(135deg,#155A8A 70%,#fafafa); }
    .inicio-header {
        background: #166b9e;
        color: #fff;
        border-radius: 1.2em;
        box-shadow: 0 3px 12px -4px #003053;
        margin: 0 0 2em 0; 
        padding: 1.3em;
    }
    .card-torneo { border-left: 8px solid #36d06f; border-radius: 1em; }
    .card-equipos { border-left: 8px solid #1678B7; border-radius: 1em; }
    .list-group-item { background: #fcfcfc; }
    .equipo-ico { width: 52px; margin-bottom:0.4em; border-radius: 50%; border:2px solid #1678B7; }
</style>

<div class="container py-4">
  @if (IsLoading)
  {
    <div class="alert alert-info text-center">
      <span class="spinner-border spinner-border-sm me-2"></span>
      <span>Cargando información...</span>
    </div>
  }

  @if (!string.IsNullOrEmpty(ErrorMessage))
  {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      @ErrorMessage
      <button type="button" class="btn-close" @onclick="() => ErrorMessage = string.Empty"></button>
    </div>
  }

  @if (!IsLoading)
  {
    <div class="inicio-header mb-4 text-center">
      <h2 class="mb-1"><i class="bi bi-house-door-fill"></i> Inicio de Usuario</h2>
      <small>Explora publicaciones, torneos y equipos cerca de ti</small>
    </div>

  <!-- Publicación Torneo -->
  <div class="card card-torneo shadow-sm mb-3">
    <div class="card-header bg-success text-white">
      <i class="bi bi-trophy"></i> Torneo Relámpago Empresarial
    </div>
    <div class="card-body">
      <div class="d-flex align-items-center flex-wrap gap-2">
        <span class="badge bg-secondary">CD FutbolCoorp | Monterrey</span>
        <span class="badge bg-info">Inicia: 25/11</span>
      </div>
      <p class="mt-2 mb-2"><b>Equipos inscritos:</b> 8</p>
      <a href="tournament-details" class="btn btn-success btn-sm me-2"><i class="bi bi-star"></i> Ver detalles</a>
      <a href="#" class="btn btn-outline-dark btn-sm"><i class="bi bi-share"></i> Compartir</a>
    </div>
  </div>

  <!-- Publicación Equipos Zona -->
  <div class="card card-equipos shadow-sm mb-3">
    <div class="card-header bg-primary text-white">
      <i class="bi bi-people-fill"></i> Equipos en tu zona
    </div>
    <div class="card-body d-flex flex-wrap gap-3">
      @foreach (var team in FeaturedTeams)
      {
        <div class="text-center">
          <img src="@team.ImageUrl" class="equipo-ico" alt="@team.Name">
          <div><small>@team.Name</small></div>
        </div>
      }
    </div>
  </div>

  <!-- Posteos sociales, anuncios -->
  <div class="list-group shadow-sm mb-4">
    @foreach (var post in RecentPosts)
    {
      <div class="list-group-item">
        <b>@@{post.Author}</b> @post.Content<br>
        <span class="text-muted small"><i class="bi bi-clock"></i> @post.TimeAgo</span>
      </div>
    }
  </div>

  <!-- Tipos de Deporte -->
  @if (TiposDeporte.Any())
  {
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-info text-white">
        <i class="bi bi-trophy"></i> Deportes Disponibles
      </div>
      <div class="card-body">
        <div class="row">
          @foreach (var deporte in TiposDeporte)
          {
            <div class="col-md-6 col-lg-4 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">@deporte.Nombre</h5>
                  <p class="card-text text-muted">@deporte.Descripcion</p>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  }

  <!-- Membresías Disponibles -->
  @if (Membresias.Any())
  {
    <div class="card shadow-sm">
      <div class="card-header bg-warning text-dark">
        <i class="bi bi-star-fill"></i> Membresías Disponibles
      </div>
      <div class="card-body">
        <div class="row">
          @foreach (var membresia in Membresias)
          {
            <div class="col-md-6 col-lg-4 mb-3">
              <div class="card border-primary h-100">
                <div class="card-body">
                  <h5 class="card-title">@membresia.Nombre</h5>
                  <p class="card-text">@membresia.Descripcion</p>
                  <p class="text-primary fw-bold">
                    <i class="bi bi-currency-dollar"></i> @membresia.Precio.ToString("N2")
                  </p>
                  <small class="text-muted">Duración: @membresia.DuracionDias días</small>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  }
  }
</div>

@code {
    private class TeamModel
    {
        public string Name { get; set; } = string.Empty;
        public string ImageUrl { get; set; } = string.Empty;
    }

    private class PostModel
    {
        public string Author { get; set; } = string.Empty;
        public string Content { get; set; } = string.Empty;
        public string TimeAgo { get; set; } = string.Empty;
    }

    private List<TeamModel> FeaturedTeams = new();
    private List<PostModel> RecentPosts = new();
    private List<TipoDeporte> TiposDeporte = new();
    private List<Membresia> Membresias = new();
    private bool IsLoading = true;
    private string ErrorMessage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            IsLoading = true;
            ErrorMessage = string.Empty;

            // Cargar tipos de deporte
            var deportesResponse = await PropietarioService.GetTiposDeporteAsync();
            if (deportesResponse.Success)
            {
                TiposDeporte = deportesResponse.Data;
                Console.WriteLine($"Tipos de deporte cargados: {TiposDeporte.Count}");
            }
            else
            {
                Console.WriteLine($"Error cargando deportes: {deportesResponse.Message}");
            }

            // Cargar membresías
            var membresiasResponse = await PropietarioService.GetMembresiasAsync();
            if (membresiasResponse.Success)
            {
                Membresias = membresiasResponse.Data;
                Console.WriteLine($"Membresías cargadas: {Membresias.Count}");
            }
            else
            {
                Console.WriteLine($"Error cargando membresías: {membresiasResponse.Message}");
            }

            // Datos estáticos
            FeaturedTeams = new List<TeamModel>
            {
                new TeamModel { Name = "Revolución FC", ImageUrl = "https://cdn-icons-png.flaticon.com/512/841/841432.png" },
                new TeamModel { Name = "Tecnólogos United", ImageUrl = "https://cdn-icons-png.flaticon.com/512/841/841461.png" }
            };

            RecentPosts = new List<PostModel>
            {
                new PostModel { Author = "Luis", Content = "busca jugadores para amistoso este viernes.", TimeAgo = "Hace 2 horas" },
                new PostModel { Author = "SportsMX", Content = "publicó resultados de jornada #10.", TimeAgo = "Hace 1 hora" }
            };
        }
        catch (Exception ex)
        {
            ErrorMessage = $"Error al cargar datos: {ex.Message}";
            Console.WriteLine($"Excepción: {ex}");
        }
        finally
        {
            IsLoading = false;
        }
    }
}